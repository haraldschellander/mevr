<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fitting the temporal Metastatistical Extreme Value Distribution (TMEV) — ftmev • mevr</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting the temporal Metastatistical Extreme Value Distribution (TMEV) — ftmev"><meta property="og:description" content="Fit the temporal MEVD distribution TMEV to rainfall observations with a cyclic spline to account for seasonality."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mevr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1-0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fitting the temporal Metastatistical Extreme Value Distribution (TMEV)</h1>
    
    <div class="hidden name"><code>ftmev.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fit the temporal MEVD distribution TMEV to rainfall observations with a cyclic spline to account for seasonality.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ftmev</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  minyears <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  day_year_interaction <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data</dt>
<dd><p>The data to which the TMEV should be fitted to. <code>data</code> must be a data.frame with two columns. 
The first column must contain dates of class  <code>Date</code>, the second or last column must contain the rainfall 
values corresponding to datums in the rows. No NA values are allowed.</p></dd>


<dt>threshold</dt>
<dd><p>A numeric that is used to define wet days as values &gt; threshold. 
\(data &lt;= threshold\) is set to NA.</p></dd>


<dt>minyears</dt>
<dd><p>Minimum number of available years for fitting a cyclic spline to the non-stationary data series (see details).</p></dd>


<dt>day_year_interaction</dt>
<dd><p>Logical. Should an additional year vs day of the year 
interaction be used for the calculation of the temporal trend in seasonality?  (see details). Default is <code>FALSE</code>.</p></dd>


<dt>verbose</dt>
<dd><p>Logical. If <code>TRUE</code>, verbose output of the temporal fitting process is shown during runtime.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list of class <code>mevr</code> with components:</p>
<dl><dt>c</dt>
<dd><p>Vector of Weibull scale parameters of the TMEV, each row refers to one event, which is a day for daiyl rainfall.</p></dd>

<dt>w</dt>
<dd><p>Vector of Weibull shape parameters of the TMEV, each row refers to one event, which is a day for daiyl rainfall.</p></dd>

<dt>n</dt>
<dd><p>Number of wet events per year. Wet events are defined as rainfall &gt; <code>threshold</code>.</p></dd>

<dt>maxima</dt>
<dd><p>Maximum values corresponding to each year.</p></dd>

<dt>data</dt>
<dd><p>A data frame with the data used to fit the TMEV and the fitted Weibull parameters <code>c</code> and <code>w</code>.</p></dd>

<dt>years</dt>
<dd><p>Vector of years as YYYY.</p></dd>

<dt>threshold</dt>
<dd><p>The chosen threshold.</p></dd>

<dt>x</dt>
<dd><p>The fitted <code>bamlss</code> object.</p></dd>

<dt>type</dt>
<dd><p>The type of distribution ("TMEV").</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>With the aim of exploiting the full temporal information for parameter estimation, 
Falkensteiner et al., (2023) introduced the TMEV, which is an explicitly 
non-stationary formulation of the MEVD (Marani and Ignaccolo, 2015). Adopting a 
Weibull distribution for ordinary rainfall events, the assumption of yearly 
constant coefficients is relaxed by allowing the Weibull
parameters to fluctuate with time. The TMEV can then be written as</p>
<p>$$F = \frac{1}{T} \sum_{j=1}^T \prod_{k \in A_j} \left( 1-e^{-\left(\frac{x}{C(j,k)}\right)^{w(j,k)}} \right)$$</p>
<p>with \(w &gt; 0\) and \(C &gt; 0\) being the Weibull shape and scale parameters, and 
$A_j \subseteq (1, ..., 366)$ being the wet days in year j. The temporal and 
the superimposed seasonal dependence on w and c is modeled with a cyclic seasonal 
effect on the day of the year.</p>
<p>Technically this is accomplished by fitting a cyclic spline to the daily rainfall 
values. The following formula is used for the fitting procedure of both the Weibull scale and 
shape parameter with the function <code><a href="http://www.bamlss.org/reference/bamlss.html" class="external-link">bamlss</a></code> from package <code>bamlss</code>:</p>
<p>$$parameter = x \sim s(year) + ti(yday, bs = "cc", k = 10)$$</p>
<p>The first effect models the long-term temporal trend of the parameter with a thin-plate spline. 
The second effect models the superimposed seasonal fluctuations of the parameter 
with the 'day of the year' with a cyclic cubic regression spline and 10 knots, 
to ensure a smooth transition between December and January.</p>
<p>For data series with lengths &lt; 10 years, the first temporal effect is changed to 
a simple linear time trend.</p>
<p>For trend analysis, an additional interaction term can be added to the model formula. 
The following term models the relationship between the seasonality as day of the year 
and the year itself with a combination of a thin plate and a cyclic cubic spline:</p>
<p>$$ti(year, yday, bs = c("tp", "cc"), d = c(1, 1), k = c(10, 10))$$</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Marani, M. and Ignaccolo, M. (2015) 'A metastatistical approach to rainfall extremes', Advances in Water Resources. Elsevier Ltd, 79(Supplement C), pp. 121-126. doi: 10.1016/j.advwatres.2015.03.001.</p>
<p>Falkensteiner, M., Schellander, H., Hell, T. (2023) 'A non-stationary approach to the Metastatistical Extreme Value Distribution', (to appear).</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="fmev.html">fmev</a></code>, <code><a href="fsmev.html">fsmev</a></code></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Marc-Andre Falkensteiner, Harald Schellander</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">dailyrainfall</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">ftmev</span><span class="op">(</span><span class="va">dailyrainfall</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"rl"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ftmev-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># temporal trend of the Weibull parameters </span></span></span>
<span class="r-in"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(parse(text = x), envir = envir_formula):</span> object 'yday_ti_shape_k' not found</span>
<span class="r-in"><span><span class="va">pred_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, term <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(parse(text = x), envir = envir_formula):</span> object 'yday_ti_shape_k' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">c.pred</span> <span class="op">~</span> <span class="va">year</span>, data <span class="op">=</span> <span class="va">pred</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(m$data, parent.frame()):</span> object 'pred' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pred_year</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">year</span> <span class="op">-</span> <span class="fl">1970</span>, <span class="va">c.pred.year</span>, type <span class="op">=</span> <span class="st">"b"</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'pred_year' not found</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Harald Schellander.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

