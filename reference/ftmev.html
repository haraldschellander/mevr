<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fitting the temporal Metastatistical Extreme Value Distribution (TMEV) — ftmev • mevr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting the temporal Metastatistical Extreme Value Distribution (TMEV) — ftmev"><meta name="description" content="Fit the temporal MEVD distribution TMEV to rainfall observations with a cyclic spline to account for seasonality."><meta property="og:description" content="Fit the temporal MEVD distribution TMEV to rainfall observations with a cyclic spline to account for seasonality."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mevr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fitting the temporal Metastatistical Extreme Value Distribution (TMEV)</h1>

      <div class="d-none name"><code>ftmev.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fit the temporal MEVD distribution TMEV to rainfall observations with a cyclic spline to account for seasonality.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ftmev</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  minyears <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  day_year_interaction <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  yday_ti_shape_k <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  yday_ti_scale_k <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  year_ti_shape_k <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  year_ti_scale_k <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>The data to which the TMEV should be fitted to. <code>data</code> must be a data.frame with two columns.
The first column must contain dates of class  <code>Date</code>, the second or last column must contain the rainfall
values corresponding to datums in the rows. No negative values are allowed. NA values are removed with a warning.</p></dd>


<dt id="arg-threshold">threshold<a class="anchor" aria-label="anchor" href="#arg-threshold"></a></dt>
<dd><p>A numeric that is used to define wet days as values &gt; threshold.
\(data &lt;= threshold\) is set to NA.</p></dd>


<dt id="arg-minyears">minyears<a class="anchor" aria-label="anchor" href="#arg-minyears"></a></dt>
<dd><p>Minimum number of available years for fitting a cyclic spline to the non-stationary data series (see details).</p></dd>


<dt id="arg-day-year-interaction">day_year_interaction<a class="anchor" aria-label="anchor" href="#arg-day-year-interaction"></a></dt>
<dd><p>Logical. Should an additional year vs day of the year
interaction be used for the calculation of the temporal trend in seasonality?  (see details). Default is <code>FALSE</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, verbose output of the temporal fitting process is shown during runtime.</p></dd>


<dt id="arg-yday-ti-shape-k">yday_ti_shape_k<a class="anchor" aria-label="anchor" href="#arg-yday-ti-shape-k"></a></dt>
<dd><p>A numeric that is used to set the dimension of the bases used to represent the smooth term ti() for yday in the formula for shape.</p></dd>


<dt id="arg-yday-ti-scale-k">yday_ti_scale_k<a class="anchor" aria-label="anchor" href="#arg-yday-ti-scale-k"></a></dt>
<dd><p>A numeric that is used to set the dimension of the bases used to represent the smooth term ti() for yday in the formula for scale.</p></dd>


<dt id="arg-year-ti-shape-k">year_ti_shape_k<a class="anchor" aria-label="anchor" href="#arg-year-ti-shape-k"></a></dt>
<dd><p>A numeric that is used to set the dimension of the bases used to represent the smooth term ti() for year in the formula for shape (only used when day_year_interaction == TRUE).</p></dd>


<dt id="arg-year-ti-scale-k">year_ti_scale_k<a class="anchor" aria-label="anchor" href="#arg-year-ti-scale-k"></a></dt>
<dd><p>A numeric that is used to set the dimension of the bases used to represent the smooth term ti() for year in the formula for scale (only used when day_year_interaction == TRUE).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list of class <code>mevr</code> with components:</p>
<dl><dt>c</dt>
<dd><p>Vector of Weibull scale parameters of the TMEV, each row refers to one event, which is a day for daiyl rainfall.</p></dd>

<dt>w</dt>
<dd><p>Vector of Weibull shape parameters of the TMEV, each row refers to one event, which is a day for daiyl rainfall.</p></dd>

<dt>n</dt>
<dd><p>Number of wet events per year. Wet events are defined as rainfall &gt; <code>threshold</code>.</p></dd>

<dt>maxima</dt>
<dd><p>Maximum values corresponding to each year.</p></dd>

<dt>data</dt>
<dd><p>A data frame with the data used to fit the TMEV and the fitted Weibull parameters <code>c</code> and <code>w</code>.</p></dd>

<dt>years</dt>
<dd><p>Vector of years as YYYY.</p></dd>

<dt>threshold</dt>
<dd><p>The chosen threshold.</p></dd>

<dt>x</dt>
<dd><p>The fitted <code>bamlss</code> object.</p></dd>

<dt>type</dt>
<dd><p>The type of distribution ("TMEV").</p></dd>

<dt>minyears</dt>
<dd><p>The minimum number of years used to fit the TMEV as provided.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>With the aim of exploiting the full temporal information for parameter estimation,
Falkensteiner et al., (2023) introduced the TMEV, which is an explicitly
non-stationary formulation of the MEVD (Marani and Ignaccolo, 2015). Adopting a
Weibull distribution for ordinary rainfall events, the assumption of yearly
constant coefficients is relaxed by allowing the Weibull
parameters to fluctuate with time. The TMEV can then be written as</p>
<p>$$F = \frac{1}{T} \sum_{j=1}^T \prod_{k \in A_j} \left( 1-e^{-\left(\frac{x}{C(j,k)}\right)^{w(j,k)}} \right)$$</p>
<p>with \(w &gt; 0\) and \(C &gt; 0\) being the Weibull shape and scale parameters, and
$A_j \subseteq (1, ..., 366)$ being the wet days in year j. The temporal and
the superimposed seasonal dependence on w and c is modeled with a cyclic seasonal
effect on the day of the year.</p>
<p>Technically this is accomplished by fitting a cyclic spline to the daily rainfall
values. The following formula is used for the fitting procedure of both the Weibull scale and
shape parameter with the function <code><a href="http://www.bamlss.org/reference/bamlss.html" class="external-link">bamlss</a></code> from package <code>bamlss</code>:</p>
<p>$$parameter = x \sim s(year) + ti(yday, bs = "cc", k = 10)$$</p>
<p>The first effect models the long-term temporal trend of the parameter with a thin-plate spline.
The second effect models the superimposed seasonal fluctuations of the parameter
with the 'day of the year' with a cyclic cubic regression spline and 10 knots,
to ensure a smooth transition between December and January. The number of knots (k)
in the above equation can be set separately for the year and yday effect as well as
separately for the shape and scale parameter of the Weibull distribution. This can be done
by overwriting the parameters <code>yday_ti_shape_k</code>, <code>yday_ti_scale_k</code>,
<code>year_ti_shape_k</code>, <code>year_ti_scale_k</code> in the call to <code>ftmev</code>. Note that
these values depend on many factors, such as the structure of the data, the TMEV is fitted to.
Please refer to the documentation of the packages <code><a href="http://www.bamlss.org/reference/bamlss.html" class="external-link">bamlss</a></code> and,
in particular <code><a href="https://rdrr.io/pkg/mgcv/man/mgcv-package.html" class="external-link">mgcv</a></code>.</p>
<p>For data series with lengths &lt; 10 years, the first temporal effect is changed to
a simple linear time trend.</p>
<p>For trend analysis, an additional interaction term can be added to the model formula.
The following term models the relationship between the seasonality as day of the year
and the year itself with a combination of a thin plate and a cyclic cubic spline:</p>
<p>$$ti(year, yday, bs = c("tp", "cc"), d = c(1, 1), k = c(year_ti_k, yday_ti_k))$$</p>
<p>This function returns the parameters of the fitted TMEV distribution as well as some
additional fitting results and input parameters useful for further analysis.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Marani, M. and Ignaccolo, M. (2015) 'A metastatistical approach to rainfall extremes', Advances in Water Resources. Elsevier Ltd, 79(Supplement C), pp. 121-126. doi: 10.1016/j.advwatres.2015.03.001.</p>
<p>Falkensteiner, M., Schellander, H., Hell, T. (2023) 'Accounting for seasonality in the metastatistical extreme value distribution', (Weather and Climate Extremes, 42, 2023, https://doi.org/10.1016/j.wace.2023.100601).</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="fmev.html">fmev</a></code>, <code><a href="fsmev.html">fsmev</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Marc-Andre Falkensteiner, Harald Schellander</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">dailyrainfall</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">ftmev</span><span class="op">(</span><span class="va">dailyrainfall</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"rl"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ftmev-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># temporal trend of the Weibull parameters</span></span></span>
<span class="r-in"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pred_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, term <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">c.pred</span> <span class="op">~</span> <span class="va">year</span>, data <span class="op">=</span> <span class="va">pred</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pred_year</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">year</span> <span class="op">-</span> <span class="fl">1970</span>, <span class="va">c.pred.year</span>, type <span class="op">=</span> <span class="st">"b"</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ftmev-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Harald Schellander.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

